# 备注

这个文档可不是DEBUG文档，而是备注文档。本文档主要用于极其粗略地说明独立按键的工作原理。

![image-20240630152458815](https://md-wind.oss-cn-nanjing.aliyuncs.com/md/%E7%8B%AC%E7%AB%8B%E6%8C%89%E9%94%AE.png)

上面是独立按键的构造图。

![image-20240630152700255](https://md-wind.oss-cn-nanjing.aliyuncs.com/md/%E7%8B%AC%E7%AB%8B%E6%8C%89%E9%94%AE%E5%8E%9F%E7%90%86%E5%9B%BE.png)

上面是独立按键的原理图，独立按键就连接在管脚上。最左边的是口线寄存器，在此种情况下，只需要知道它输出高电平；非门将高电平反向成低电平，与场效应管的栅极相连接；而场效应管的源极又接地，所以场效应管不导通。在按键不被按下的情况下，场效应管的漏极既不与栅极源极导通（场效应管是关闭的），又不与独立按键的GND连接（没按下），至于那个“输入数据”，只是发挥一个读取电位的功能，这就意味着漏极是一个悬空的状态，而漏极又通过上拉电阻与VCC相连，漏极又是悬空的，所以没有电流流过，没电位流过，那从VCC到漏极其电势都是相等的，这样“输入数据”就检测到了一个高电平；当按钮按下后，VCC就相当于中间隔着一个上拉电阻与GND相连，这样就形成回路了，由于这个上拉电阻的阻值很大，就会分担绝大多数的电压，漏极就会检测到低电平。



这里还有一个按键消抖需要讲。当按下或释放按键时，按键的接触点会在短时间内多次接触和分离，导致电平在高低之间快速切换。这种抖动时间通常在几毫秒到几十毫秒之间。由于电平信号并不稳定，所以电路系统就会误判按键状态。为了解决这个问题，可以从硬件和软件两个方向下功夫。

- 硬件

  1. 在按键与GND之间连接一个电容，并在按键与电位检测点之间连接一个电阻，从而实现RC低波滤通电路，具体原理我也不知道
  2. 使用施密特触发器，这个我更不知道。

- 软件

  1. 既然按键状态改变时的电平信号不稳定，那我就干脆不检测。一旦我检测到电平信号发生改变，那就先等一会，即延迟一会，再检测，如果过一会检测到的电平信号和刚开始的电平信号一致，那就承认此次的按键状态改变有效。那到底多长时间才算“一会”呢？这取决于两个方面：

  - 按键抖动的持续时间，一遍情况下，是几毫秒到几十毫秒
  - 系统的响应时间，通俗的说，类似于鼠标点击到电脑有反应的那段时间
    - 通常，延迟时间设置在10毫秒到50毫秒之间是比较常见的选择。具体的延迟时间可以根据实际情况进行调整。

  2. 连续多次读取按键状态，如果在一段时间内按键状态一致，则认为按键状态有效。

对于我们来说，当然用的是软件消抖，毕竟单片机上没有消抖硬件呀。

